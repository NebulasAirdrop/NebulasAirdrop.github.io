<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="img/naslogo.png">

    <title>Airdrops</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
    <link href="css/core.css" rel="stylesheet" type="text/css">
    <link href="css/components.css" rel="stylesheet" type="text/css">
    <link href="css/colors.css" rel="stylesheet" type="text/css">
    <link href="css/summernote.css" rel="stylesheet" type="text/css">
    <link href="css/owl.carousel.min.css" rel="stylesheet" type="text/css">
    <link href="css/owl.theme.default.min.css" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <link href="airdrop.css" rel="stylesheet">

    <!-- Import Javascript -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/nebPay.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/nebulas.js"></script>
    <script src="js/airdropConfig.js"></script>
    <script src="js/nebConfig.js"></script>
    <script src="js/mustache.min.js"></script>

  </head>

      <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow">
        <img src="img/naslogo.png" height="50" width="50">
        <h4 class="my-0 mr-md-auto font-weight-normal" style="padding-left: 0px; padding-right: 0px">&nbsp;Nebulas</h4>
        <h4 class="my-0 mr-md-auto font-weight-normal" style="padding-left: 5px; padding-right: 10px">&nbsp;Airdrop</h4>
        <input type="text" id="address" class="form-control" placeholder="n1UUr6ipRiboc..." value="" name="address" style="margin-left: 10px">
        <button type="button" class="btn btn-primary" onclick="search()" style="margin: 10px">搜索</button>
        <nav class="my-2 my-md-0 mr-md-3">
          <a class="btn btn-outline-primary" href="#one-click-airdrop-section">一键领取</a>
        </nav>
        <nav class="my-2 my-md-0 mr-md-3">
        <a class="btn btn-outline-primary" href="new.html#">创建新空投</a>
        </nav>
        <nav class="my-2 my-md-0 mr-md-3">
          <a class="btn btn-outline-primary" href="promotion.html" target="_blank">领取攻略</a>
        </nav>
        <nav class="my-2 my-md-0 mr-md-3">
          <a class="btn btn-outline-primary" href="en/index.html">English</a>
        </nav>
      </div>

      <section class="promotion-airdrop-section">
        <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
          <h1 class="display-4">星云空投推广计划</h1>
          <p class="lead">与星云激励计划的奖励周期一致，我们将在本网站上每周设置一个空投，空投的代币用于计算分红，分红资金来源于星云空投该周在星云激励计划中获得的奖金。我们每个奖励周期拿出最多20%的奖金分红给期间参与星云空投推广计划的用户。</p>
        </div>

        <div class="container" >
          <div class="card-deck mb-2 text-center" id="promotions">
          </div>
        </div>
      </section>

      <section class="referrer-section" id="referrer">
        <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
          <h2 class="display-5">通过邀请好友来获得更多空投?</h2>
          <p class="lead">每当您的朋友通过您的邀请链接获得空投时，您可以获得额外的代币。您的朋友也会从您的邀请链接中获得额外的代币。</p>
        </div>
        <div class="container">
          <div class="card-deck mb-3 text-center">
            <div class="card mb-4 box-shadow">
              <div class="card-body">
                <input type="text" id="referrer_address" class="form-control" placeholder="n1UUr6ipRiboc..." value="" name="referrer_address">
                <button type="button" class="btn btn-primary" onclick="generateLink()" style="margin: 10px">产生邀请链接</button>
              </div>
            </div>
          </div>
        </div>
        <div id="referrer_link">
        </div>
      </section>

      <section class="referrer-section" id="one-click-airdrop-section">
        <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
          <h2 class="display-5">步骤太繁琐?</h2>
          <p class="lead">如果您觉得领取空投的步骤非常繁琐,我们也提供了一键领取"星云推广计划"空投的方式。</p>
        </div>
        <div class="container">
          <div class="card-deck mb-3 text-center">
            <div class="card mb-4 box-shadow">
              <div class="card-body">
                <input type="password" id="password" class="form-control" placeholder="请设置一个不容易被别人猜到的长度大于9位的密码" value="" name="password"><br>
                <input type="password" id="password_confirm" class="form-control" placeholder="请再次输入密码，确保与上面的密码一致" value="" name="password_confirm">
                <button type="button" id="oneClick" class="btn btn-primary" onclick="oneClick()" style="margin: 10px">一键领取</button>
              </div>
            </div>
          </div>
        </div>
        <div id="referrer_link2">
        </div>
      </section>

  <section class="airdrop-section">
    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
      <h2 class="display-5">其他空投项目</h2>
      <p class="lead">在星云空投上列出项目是免费的。因为我们在星云主网上部署了智能合约，并将该网站作为Dapp运行，所以您的空投项目仅仅需要几秒钟就能发布。请注意不要产生垃圾空投项目，否则你的星云地址将被列入黑名单。</p>
    </div>
    <div class="container" >
      <div class="card-deck mb-2 text-center" id="airdrops">
      </div>
    </div>

    <div class="container" >
      <div class="card-deck mb-2 text-center" id="testAirdrops">
      </div>
    </div>
  </section>

      <section class="info-section" id="info">
        <div class="container">
          <div class="row">
            <h2 class="display-5">常见问题</h2>
            <div class="col-lg-12">
              <div class="panel info-panel"><div class="panel-heading">
                <h3>什么是空投?</h3>
              </div><div class="panel-content" style="overflow: hidden; height: 0px;">
                <div class="info-content">
                  <p style="word-break: break-word; color: rgb(51, 51, 51);"><b>​空投</b>​是区块链项目向社区分发免费代币或基础币。 </p><p style="word-break: break-word; color: rgb(51, 51, 51);">要接收空投，通常唯一的要求是您拥有相应区块链的基础币。</p><p style="word-break: break-word; color: rgb(51, 51, 51);">在星云空投平台中任何持有星云币的人将有机会获得一定数量的免费代币。</p>
                </div>
              </div>
              </div>
            </div>
            <div class="col-lg-12">
              <div class="panel info-panel"><div class="panel-heading">
                <h3>没有星云币(NAS)怎么办?</h3>
              </div><div class="panel-content" style="overflow: hidden; height: 0px;">
                <div class="info-content">
                  <p style="word-break: break-word; color: rgb(51, 51, 51);">NAS可以在各大数字货币交易所进行购买，再转账到你个人的NAS地址。这里也列出了一些免费提供少量NAS的网站。<br><ol><li style="word-break: break-word; color: rgb(51, 51, 51);"><a href="https://nas.biyouduo.com">https://nas.biyouduo.com</a></li><li style="word-break: break-word; color: rgb(51, 51, 51);"><a href="https://nebulagram.com/">https://nebulagram.com</a></li><li style="word-break: break-word; color: rgb(51, 51, 51);"><a href="http://givemenas.com/home.html">http://givemenas.com</a> </li></ol><p style="word-break: break-word; color: rgb(51, 51, 51);">定期查看你的钱包，看看你是否收到惊喜的空投。</p>
                </div>
              </div>
              </div>
            </div>
            <div class="col-lg-12">
              <div class="panel info-panel"><div class="panel-heading">
                <h3>为什么项目方免费发放代币?</h3>
              </div><div class="panel-content" style="overflow: hidden; height: 0px;">
                <div class="info-content">
                  <p style="word-break: break-word; color: rgb(51, 51, 51);">如果你不需要为产品付费，那么你就是"产品"。通过空投，该项目可以提高对项目或代币的认识。它让人们参与到本来不会拥有或听说过的项目中。这可能会导致代币价格升值，因为人们认为他们拥有的代币比他们不拥有的代币高。这被称为禀赋效应。</p><p style="word-break: break-word; color: rgb(51, 51, 51);">空投创建拥有代币的人的社区/网络。 如果您将代币分布画成饼图，饼图的很大一部分仍然由项目开发方拥有。 另一大部分由参与预售的人所拥有。 而合理的部分则归投资ICO的人所有。 空投会为饼图增加额外的切片，并且该切片将拥有最多的人。</p><p style="word-break: break-word; color: rgb(51, 51, 51);">空投还会播种一颗种子。 当你看着Coinmarketcap时，你会看到一千个货币的列表。 就在第一页，你可以看到100个货币列出。 但是，如果你有或者有一个货币，这个名字仍然在你的脑中。 种子种植，每当您检查Coinmarketcap并向下滚动时，免费数字货币的名称就会跳出来，人们会查看它的价格变动。如果他们拥有它或以前拥有它，当他们看到有关免费数字货币表现良好或不好的文章，他们更有可能点击它。 这就像广告！</p><p style="word-break: break-word; color: rgb(51, 51, 51);">展望未来，可能的空投的发展方向是开始向持有相关数字货币的用户赠送代币，我们也可以看到一些项目激励其他项目将空投给他们的数字货币所有者并同时获得一些回报。 就像我们已经看到的星云币，以太坊，波浪币，未来币等。</p>
                </div>
              </div>
              </div>
            </div>
            <div class="col-lg-12">
              <div class="panel info-panel"><div class="panel-heading">
                <h3>怎么出售数字代币?</h3>
              </div><div class="panel-content" style="overflow: hidden; height: 0px;">
                <div class="info-content">
                  <p style="word-break: break-word; color: rgb(51, 51, 51);">所以现在你有免费的数字货币，你可以做什么？许多空投的货币是在PRE-ICO阶段或刚刚完成ICO。 这通常意味着它尚未在更大的交易所进行交易。 你可以查看 <a href="https://coinmarketcap.com" target="_blank">coinmarketcap.com</a></p><p style="word-break: break-word; color: rgb(51, 51, 51);"></p><p style="word-break: break-word; color: rgb(51, 51, 51);">我们希望你能获得尽可能多的空投，并随着时间的推移增值。 许多现在排名前40的数字货币项目在早期阶段都进行了空投。 您不需要立即出售您的免费数字货币，成为HODLer没有任何问题。</p>
                </div>
              </div>
              </div>
            </div>
            <div class="col-lg-12">
              <div class="panel info-panel"><div class="panel-heading">
                <h3>怎么保障数字货币资产的安全?</h3>
              </div><div class="panel-content" style="overflow: hidden; height: 0px;">
                <div class="info-content">
                  <p style="word-break: break-word; color: rgb(51, 51, 51);">存储数字货币最安全的方法是硬件钱包和冷钱包。这些钱包离线存储您的数字货币，因此保护它们免受黑客攻击。 有一些硬件钱包可用。 我们会建议使用&nbsp;<a href="https://www.ledgerwallet.com/r/5530" target="_blank" rel="noopener noreferrer">Ledger Wallet Nano S</a>&nbsp;or&nbsp;<a href="https://trezor.io/?a=airdropalert.com" target="_blank" rel="noopener noreferrer">Trezor</a>.</p><p style="word-break: break-word; color: rgb(51, 51, 51);">并非所有的数字货币都可以存储在硬件钱包中。 我们建议您将代币或者数字货币存储在您控制的私钥钱包中。 我们不希望您的数字货币被盗！</p><p style="word-break: break-word; color: rgb(51, 51, 51);">为了避免欺诈，我们应该注意一些一般规则：</p><ol><li style="word-break: break-word; color: rgb(51, 51, 51);"><span style="color: rgb(0, 0, 0);">永远不要给出你的私钥！</span></li><li style="word-break: break-word; color: rgb(51, 51, 51);">在您的钱包上使用二次认证</li><li style="word-break: break-word; color: rgb(51, 51, 51);">下载较小项目的钱包时要当心，可能的话使用虚拟机。</li><li style="word-break: break-word; color: rgb(51, 51, 51);">切勿点击重定向到钱包的链接</li><li style="word-break: break-word; color: rgb(51, 51, 51);">在网站上注册时不要重复使用您的密码</li><li style="word-break: break-word; color: rgb(51, 51, 51);">不要直接给空投项目方打币<br></li></ol>
                </div>
              </div>
              </div>
            </div>
            <div class="col-lg-12">
              <div class="panel info-panel"><div class="panel-heading">
                <h3>想赚取更多推广的奖金?</h3>
              </div><div class="panel-content" style="overflow: hidden; height: 0px;">
                <div class="info-content">
                  <p><span style="color: rgb(51, 51, 51);">我们将对优秀的推广员将给出更多的奖励。每周我们将从候选人中选出一名在星云推广计划中表现最优秀的推广员。&nbsp;有意向申请优秀推广员的用户可以通过邮箱与我们联系。</span><span style="color: rgb(51, 51, 51);">我们的联系方式:&nbsp;</span><a href="mailto:support@mail.nasdrop.info" style="background-color: rgb(255, 255, 255);">support@mail.nasdrop.info</a><br></p>
                </div>
              </div>
              </div>
            </div>
            <div class="col-lg-12">
              <div class="panel info-panel"><div class="panel-heading">
                <h3>列出你的空投项目!</h3>
              </div><div class="panel-content" style="overflow: hidden; height: 0px;">
                <div class="info-content">
                  <p>你想要在<a href="http://nasdrop.info">nasdrop.info</a>上列出你的空投项目吗?</p><p><span style="color: rgb(51, 51, 51);">在nasdrop.info上列出的项目是免费的。 因为我们在星云主网上有一个智能合约，并将该网站作为Dapp运行，所以您的空投仅仅需要几秒钟就能发布。请注意不要产生垃圾空投项目，否则你的星云地址将被列入黑名单。<br></span><br>去 <a href="new.html">创建你的空投吧</a>!</p>
                </div>
              </div>
              </div>
            </div>
          </div>
        </div>

        <script type="text/javascript">
          function toggleVisibility(event) {
            event.preventDefault();

            var findAncestor = function (el, cls) {
              while ((el = el.parentElement) && !el.classList.contains(cls));
              return el;
            }

            var infoPanel = findAncestor(event.target, 'info-panel');

            var panelContent = infoPanel.childNodes[1];

            if (panelContent.style.overflow === "hidden") {
              panelContent.style.overflow = '';
              panelContent.style.height = '';
            } else {
              panelContent.style.overflow = 'hidden';
              panelContent.style.height = '0px';
            }
          }

          var elements = document.getElementsByClassName('panel-heading');
          for (var index in elements) {
            var element = document.getElementsByClassName('panel-heading')[index];

            if (element.addEventListener) {
              element.addEventListener('click', toggleVisibility);
            }
          }
        </script>
      </section>

    <section>
      <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
          <div class="col-12 col-md">
            <img class="mb-2" src="img/naslogo1.png" alt="" width="24" height="24">
            <small class="d-block mb-3 text-muted">&copy; 2018</small>
          </div>
          <div class="col-6 col-md">
            <h5>相关资源</h5>
            <ul class="list-unstyled text-small">
              <li><a class="text-muted" href="https://nebulas.io">星云官方网站</a></li>
              <li><a class="text-muted" href="https://explorer.nebulas.io">星云区块浏览器</a></li>
              <li><a class="text-muted" href="https://github.com/ChengOrangeJu/WebExtensionWallet">星云钱包插件</a></li>
              <li><a class="text-muted" href="https://github.com/nebulasairdrop/nebulasairdrop.github.io">项目GitHub源码</a></li>
              <li><a class="text-muted" href="" id="contract">合约地址</a></li>
            </ul>
          </div>
          <div class="col-6 col-md">
            <h5>联系我们</h5>
            <ul class="list-unstyled text-small">
              <li><a class="text-muted" href="mailto:support@mail.nasdrop.info">发送邮件</a></li>
              <li><a class="text-muted">微信群<div><img src="promotion2.jpg" height="133px" width="100px" style="position: absolute"/></div></a></li>
            </ul>
          </div>
        </div>
      </footer>
    </section>

    <script>window.jQuery || document.write('<script src="js/jquery-slim.min.js"><\/script>')</script>
    <script src="js/popper.min.js"></script>
    <script src="js/holder.min.js"></script>
    <script>
      Holder.addTheme('thumb', {
        bg: '#55595c',
        fg: '#eceeef',
        text: 'Thumbnail'
      });
      $("#contract").prop('href','https://explorer.nebulas.io/#/address/'+ dappAddress +'#/').prop('target', '_blank_');
    </script>

    <script>

      "use strict";
      //here we use neb.js to call the "get" function to search from the Dictionary
      var nebulas = require("nebulas");
      var Account = nebulas.Account;
      var neb = new nebulas.Neb();
      var Utils = nebulas.Utils;
      var Unit = nebulas.Unit;
      var Transaction = nebulas.Transaction;
      neb.setRequest(new nebulas.HttpRequest(rpcURL));

      // 搜索: 查找airdrops

      var from = Account.NewAccount().getAddressString();

      var len = 0;
      var value = "0";
      var nonce = "0";
      var gas_price = "1000000";
      var gas_limit = "2000000";
      var callFunction = "len";
      var callArgs = ""; //in the form of ["args"]
      var contract = {
        "function": callFunction,
        "args": callArgs
      };

      var accountWallet;

      neb.api.call(from, dappAddress, value, nonce, gas_price, gas_limit, contract).then(function (resp) {
        if(resp.result > 0){
          len = resp.result;
          for(var i = 0; i < resp.result; i++){
            callFunction = "index";
            callArgs = "[" + i + "]"; //in the form of ["args"]
            contract = {
              "function": callFunction,
              "args": callArgs
            };
            neb.api.call(from, dappAddress, value, nonce, gas_price, gas_limit, contract).then(function (resp){
              addAirdrop(resp);
              });
          }
        } else {
          $("#airdrops").append('<h1>哦! 这里还没有空投! <a href="new.html">创建第一个空投吧</a></h1>');
        }
      }).catch(function (err) {
        //cbSearch(err)
        console.log("error:" + err.message)
      });


      function searchAdrress(address){
        if(Account.isValidAddress(address)){
          for(var i = 0; i < len; i++){
            callFunction = "query";
            callArgs = "[" + i + ", \"" + address +"\"]"; //in the form of ["args"]
            contract = {
              "function": callFunction,
              "args": callArgs
            };

            neb.api.call(from, dappAddress, value, nonce, gas_price, gas_limit, contract).then(function (resp) {
              var result = resp.result;
              if(result === 'null'){
                console.log("null");
              } else{
                try{
                  result = JSON.parse(result);
                }catch (err){
                  //result is the error message
                  console.log("error:" + err.message)
                }
                var airdrop;
                if(!!result.balance) {
                  airdrop = $("#airdrop" + result.index);
                  airdrop.html("已领取" + result.balance + "个代币").removeClass("btn-primary").addClass("btn-outline-primary").prop("onclick", null).off('click');
                } else {
                  airdrop = $("#airdrop" + result.index);
                  if(airdrop.val() == 0){
                    airdrop.html("空投结束").removeClass("btn-primary").addClass("btn-outline-primary").prop("onclick", null).off('click');
                  } else {
                    airdrop.html("领取空投").removeClass("btn-outline-primary").addClass("btn-primary").prop("onclick", null).off('click').click(function(){ receive(result.index); });
                  }
                }

              }
            }).catch(function (err) {
              //cbSearch(err)
              console.log("error:" + err.message)
            });
          }
        } else {
          if(address != ""){
            $(document).ready(function(){
              $("#invalidAddress").modal('show');
            });
          }
        }
      }

      function search(){
        var address = $("#address").val();
        if(address === ""){
          window.addEventListener('message', function (e) {
            if (e.data.data && !!e.data.data.account) {
              address = e.data.data.account;
              accountWallet = address;
              searchAdrress(address);
            }
          });

          window.postMessage({
            "target": "contentscript",
            "data": {},
            "method": "getAccount",
          }, "*");
        }
        searchAdrress(address);
      }

      function addAirdrop(resp){
        var result = resp.result;    ////resp is an object, resp.result is a JSON string
        if(result === 'null'){
          $("#airdrops").append('<h1>哦! 这里还没有空投! <a href="new.html">创建第一个空投吧</a></h1>');
        } else{
          //if result is not null, then it should be "return value" or "error message"
          try{
            result = JSON.parse(result);
          }catch (err){
            //result is the error message
          }


          var urlParams = new URLSearchParams(window.location.search);
          var referrer;
          if(urlParams.has('referrer')){
            referrer = urlParams.get('referrer');
          } else{
            referrer = "n1UUr6ipRiboc...";
          }

          if(!!result.name) {
            var skeleton;
            var data;
            if(result.active){
              if(urlParams.has('referrer')){
                skeleton = '<div class="card mb-4 box-shadow"><div class="card-header"><h5 class="my-0 font-weight-normal">{{name}}&nbsp;<a onclick="active({{airdropIndex}}, false)"><img src="img/stop.png" height="20" width="20"></a><br><small>({{totalSupply}}&nbsp;{{symbol}} 已被{{holderNum}}人领取)</small></h5></div><div class="card-body"><h1 class="card-title pricing-card-title"><a>{{holderBonus}}</a> {{symbol}} <small class="text-muted"> / 钱包</small></h1><small class="card-title">{{desc}}</small><br><small>填写<b>推荐人</b>的钱包地址，你和你的推荐人都可以获得额外 <a>{{referrerBonus}}</a>  {{symbol}} </small><input type="text" class="form-control" id="referrer{{airdropIndex}}" placeholder="{{referrer}}" value="{{referrer}}"><br><input name="airdropIndex" type="hidden" value="{{airdropIndex}}"><button type="button" class="btn btn-lg btn-block btn-primary" id="airdrop{{airdropIndex}}" onclick="receive({{airdropIndex}})" value="{{active}}">领取空投</button></div></div>';
              } else {
                skeleton = '<div class="card mb-4 box-shadow"><div class="card-header"><h5 class="my-0 font-weight-normal">{{name}}&nbsp;<a onclick="active({{airdropIndex}}, false)"><img src="img/stop.png" height="20" width="20"></a><br><small>({{totalSupply}}&nbsp;{{symbol}} 已被{{holderNum}}人领取)</small></h5></div><div class="card-body"><h1 class="card-title pricing-card-title"><a>{{holderBonus}}</a> {{symbol}} <small class="text-muted"> / 钱包</small></h1><small class="card-title">{{desc}}</small><br><small>填写<b>推荐人</b>的钱包地址，你和你的推荐人都可以获额外 <a>{{referrerBonus}}</a>  {{symbol}} </small><input type="text" class="form-control" id="referrer{{airdropIndex}}" placeholder="{{referrer}}" value=""><br><input name="airdropIndex" type="hidden" value="{{airdropIndex}}"><button type="button" class="btn btn-lg btn-block btn-primary" id="airdrop{{airdropIndex}}" onclick="receive({{airdropIndex}})" value="{{active}}">领取空投</button></div></div>';
              }
              data = { name: result.name, symbol: result.symbol, totalSupply: result.totalSupply, holderNum: result.holderNum, holderBonus: result.holderBonus, referrerBonus: result.referrerBonus, desc: result.desc, airdropIndex: result.index, active: 1, referrer: referrer};
            } else {
              skeleton = '<div class="card mb-4 box-shadow"><div class="card-header"><h5 class="my-0 font-weight-normal">{{name}}&nbsp;<a onclick="active({{airdropIndex}}, true)"><img src="img/start.png" height="20" width="20"></a><br><small>({{totalSupply}}&nbsp;{{symbol}} 已被{{holderNum}}人领取)</small></h5></div><div class="card-body"><h1 class="card-title pricing-card-title"><a>{{holderBonus}}</a> {{symbol}} <small class="text-muted"> / 钱包</small></h1><small class="card-title">{{desc}}</small><br><small>填写<b>推荐人</b>的钱包地址，你和你的推荐人都可以获额外 <a>{{referrerBonus}}</a>  {{symbol}} </small><input type="text" class="form-control" id="referrer{{airdropIndex}}" placeholder="{{referrer}}" value=""><br><input name="airdropIndex" type="hidden" value="{{airdropIndex}}"><button type="button" class="btn btn-lg btn-block btn-outline-primary" id="airdrop{{airdropIndex}}" value="{{active}}">空投结束</button></div></div>';
              data = { name: result.name, symbol: result.symbol, totalSupply: result.totalSupply, holderNum: result.holderNum, holderBonus: result.holderBonus, referrerBonus: result.referrerBonus, desc: result.desc, airdropIndex: result.index, active: 0, referrer: referrer};
            }
            var html = Mustache.to_html(skeleton, data);
            if(promotion.includes(parseInt(result.index))){
              $("#promotions").append(html);
            } else if (airdrop.includes(parseInt(result.index))) {
              $("#airdrops").append(html);
            } else {
              $("#testAirdrops").append(html);
            }
            search();
          } else {
            $("#airdrops").append('<h1>Oops! There are no airdrops! <a href="new.html">Create the first Airdrop</a></h1>');
          }
        }
      }

      // 添加信息功能: 像super-dictionary 中添加词条
      var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
      var nebPay = new NebPay();
      var serialNumber;

      function receive(index){
        if(checkNASWallet()){
          var to = dappAddress;
          var value = "0";
          var callFunction = "receive";
          var referrer = $("#referrer" + index).val();
          if(referrer == "" || Account.isValidAddress(referrer)){
            console.log(accountWallet);
            if(accountWallet === referrer){
              $(document).ready(function(){
                $("#invalidReferrer").modal('show');
              });
            } else {
              var callArgs = "[" + index + ", \"" + referrer + "\"]";
              console.log(callArgs);
              serialNumber = nebPay.call(to, value, callFunction, callArgs, {
                listener: function (resp) {
                  if(resp !== 'Error: Transaction rejected by user'){
                    $('#packing').modal('show');
                  }
                  var hash = resp.txhash;
                  recheckTransactionReceipt(hash, function () {
                    $('#packing').modal('hide');
                    $('#packing_success').modal('show');
                    function clearWait(){
                      clearInterval(wait);
                      window.location.href = window.location.href;
                    }
                    var wait = setInterval(clearWait, 2000);
                  })
                }
              });
            }

          } else {
            $(document).ready(function(){
              $("#invalidAddress").modal('show');
            });
          }
        }

      }

      function getTransactionReceipt(hash, callback){
        $.post(rpcURL + '/v1/user/getTransactionReceipt', JSON.stringify({
          "hash": hash
        }), function (resp) {
          callback(resp)
        })
      }


      function recheckTransactionReceipt(hash, cb) {
        var task = setInterval(function () {
          getTransactionReceipt(hash, function (resp) {
            var status = resp.result.status;
            if(status == 1){
              clearInterval(task);
              cb();
            }
          })
        }, 1000);
      }

      function active(index, _active){
        if(checkNASWallet()) {
          var to = dappAddress;
          var value = "0";
          var callFunction = "active";
          var callArgs;
          if (_active) {
            callArgs = "[" + index + ", " + 1 + "]";
          } else {
            callArgs = "[" + index + ", " + 0 + "]";
          }
          serialNumber = nebPay.call(to, value, callFunction, callArgs, {
            listener: function (resp) {
              if(resp !== 'Error: Transaction rejected by user'){
                $('#packing').modal('show');
              }
              var hash = resp.txhash;
              recheckTransactionReceipt(hash, function () {
                $('#packing').modal('hide');
                $('#packing_success').modal('show');
                function clearWait(){
                  clearInterval(wait);
                  window.location.href = window.location.href;
                }
                var wait = setInterval(clearWait, 2000);

              })
            }
          });

        }
      }

      function checkNASWallet(){

        //to check if the extension is installed
        //if the extension is installed, var "webExtensionWallet" will be injected in to web page
        if (typeof (webExtensionWallet) === "undefined") {
          $(document).ready(function(){
            $("#noWallet").modal('show');
          });
          return false;
        }
        return true;
      }


      function generateLink(){
        var url_refer = document.location.href;

        if(url_refer.lastIndexOf('?') >0){
          url_refer = url_refer.split("?")[0];
        }
        if(url_refer.lastIndexOf('#') > 0){
          url_refer = url_refer.split("#")[0];
          console.log(url_refer);
        }
        var address = $("#referrer_address").val();

        if (address === ""){
          window.addEventListener('message', function (e) {
            if (e.data.data && !!e.data.data.account) {
              address = e.data.data.account;
              if(Account.isValidAddress(address)){
                accountWallet = address;
                var skeleton = '<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center"><a href="{{url_refer}}?referrer={{address}}"><p class="lead">{{url_refer}}?referrer={{address}}</p></a></div>';
                var data = { url_refer: url_refer, address: address};
                var html = Mustache.to_html(skeleton, data);
                $("#referrer_link").html('').append(html);
              }
            }
          });

          window.postMessage({
            "target": "contentscript",
            "data": {},
            "method": "getAccount",
          }, "*");
        } else {
          if(Account.isValidAddress(address)){
            var skeleton = '<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center"><a href="{{url_refer}}?referrer={{address}}"><p class="lead">{{url_refer}}?referrer={{address}}</p></a></div>';
            var data = { url_refer: url_refer, address: address};
            var html = Mustache.to_html(skeleton, data);
            $("#referrer_link").html('').append(html);
          } else {
            $(document).ready(function(){
              $("#invalidAddress").modal('show');
            });
          }
        }
      }

      var hasOneClicked = false;
      var newAccount;
      var newAccountInfo = {};


      function oneClick(){
          if(!hasOneClicked){
            if((typeof newAccount) === 'undefined'){
              var password = $("#password").val().trim();
              var passwordConfirm = $('#password_confirm').val().trim();
              if(password === passwordConfirm){
                if(password.length < 9){
                  alert('密码至少要9位数字符号或字母');
                } else {
                  newAccount = Account.NewAccount();
                  var address = newAccount.getAddressString();
                  var key;
                  key = newAccount.toKey(password);
                  newAccountInfo.address = address;
                  newAccountInfo.key = JSON.stringify(key);
                  sendFreeNas(address, function(){
                    prepareParams(address, function(params){
                      var gTx = new nebulas.Transaction(chainId,
                              newAccount,
                              params.to, params.value, params.nonce, params.gasPrice, params.gasLimit, params.contract);

                      gTx.signTransaction();
                      $('#newWalletAddress').html(address).prop('href', 'https://explorer.nebulas.io/#/address/' + address).prop('target', '_blank_');
                      $('#newWalletKey').html(JSON.stringify(key));
                      $('#oneClickAccount').modal('show');
                      neb.api.sendRawTransaction(gTx.toProtoString())
                              .then(function (resp) {
                                var hash = resp.txhash;
                                recheckTransactionReceipt(hash, function () {
                                  function clearWait(){
                                    $("#showOneClickSuccess").html("一键领取成功！快右键复制<a target='_blank' href='http://nasdrop.info?referrer="+ address +"'>推荐链接</a>发给好友来获得更多奖励吧！");
                                    $("#oneClick").html("领取成功！显示私钥");
                                    hasOneClicked = true;
                                    clearInterval(wait);
                                  }
                                  var wait = setInterval(clearWait, 2000);
                                })
                              })
                              .catch(function (err) {
                                console.log(err)
                              });
                    });
                  });

                }
              } else{
                alert('两次输入的密码不一致');
              }
            } else {
              $(document).ready(function(){
                $("#showOneClickSuccess").html("一键领取成功！快右键复制<a target='_blank' href='http://nasdrop.info?referrer="+ newAccountInfo.address +"'>推荐链接</a>发给好友来获得更多奖励吧！");
                $('#newWalletAddress').html(newAccountInfo.address).prop('href', 'https://explorer.nebulas.io/#/address/' + newAccountInfo.address).prop('target', '_blank_');
                $('#newWalletKey').html(newAccountInfo.key);
                $("#oneClickAccount").modal('show');
              });
            }

          } else {
            $('#newWalletAddress').html(newAccountInfo.address).prop('href', 'https://explorer.nebulas.io/#/address/' + newAccountInfo.address).prop('target', '_blank_');
            $('#newWalletKey').html(newAccountInfo.key);
            $(document).ready(function(){
              $("#oneClickAccount").modal('show');
            });
          }
      }


      function sendFreeNas(toAddress, callback) {
        var account, tx, txhash;
        account = Account.NewAccount();
        account.setPrivateKey("2f9ab0f3a013f35313453125d60b42286eba22e72a907ab1afd670163efd042e");
          neb.api.getAccountState(account.getAddressString()).then(function (state) {
            state = state.result || state;
            tx = new Transaction(chainId, account, toAddress, Unit.nasToBasic(0.000001), parseInt(state.nonce) + 1);
            tx.signTransaction();
            $('#newWallet').html(toAddress).prop('href', 'https://explorer.nebulas.io/#/address/' + toAddress).prop('target', '_blank_');
            $('#parepareWallet').modal('show');
            neb.api.sendRawTransaction(tx.toProtoString()).then(function(resp){
                var hash = resp.txhash;
                recheckTransactionReceipt(hash, function () {
                  function clearWait(){
                    clearInterval(wait);
                    callback();
                    $('#parepareWallet').modal('hide');
                    $("#password").hide();
                    $("#password_confirm").hide();
                    $("#oneClick").html("显示私钥");
                  }
                  var wait = setInterval(clearWait, 2000);
                })
              }
            ).catch(function (err) {
              console.log(err);
            })
          }).catch(function (err) {
            console.log(err);
          })
      }


      function prepareParams(fromAddress, callback) {
        let params = {};

        params.from = fromAddress;
        params.to = dappAddress;

        params.gasLimit = 200000;
        params.gasPrice = 1000000;
        params.value = 0;

        // prepare contract
        params.contract = {
          "function": "receive",
          "args": "[" + promotionId + ", \"\"]"
        };

        neb.api.getAccountState(params.from).then(function (resp) {
          var balance = nebulas.Unit.fromBasic(resp.balance, "nas");
          params.nonce = parseInt(resp.nonce) + 1;
          callback(params);
        }).catch(function (err) {
           console.log("prepare params error: " + err);
        });
      }


      function copyPrivateKey(){
        var key = $('#newWalletKey');
        if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {
          var el = key.get(0);
          var editable = el.contentEditable;
          var readOnly = el.readOnly;
          el.contentEditable = true;
          el.readOnly = false;
          var range = document.createRange();
          range.selectNodeContents(el);
          var sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
          el.setSelectionRange(0, 999999);
          el.contentEditable = editable;
          el.readOnly = readOnly;
        } else {
          key.select();
        }
        document.execCommand('copy');
        key.blur();
        alert('私钥拷贝成功');
      }

    </script>

    <div id="noWallet" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">警告</h4>
          </div>
          <div class="modal-body">
            <p>未安装星云钱包插件。请使用谷歌(Chrome)浏览器并且安装<a href="https://github.com/ChengOrangeJu/WebExtensionWallet" target="_blank">星云钱包插件</a>。或者通过<a href="#one-click-airdrop-section">一键领取</a>的方式获得星云推广计划的空投</p>
          </div>
          <div class="modal-footer"  style="padding-top: 10px">
            <br>
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


  <div id="invalidAddress" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">警告</h4>
        </div>
        <div class="modal-body">
          <p>星云账号地址格式错误!</p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="invalidReferrer" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">警告</h4>
        </div>
        <div class="modal-body">
          <p>推荐人不能是自己!</p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="hasOneClicked" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">警告</h4>
        </div>
        <div class="modal-body">
          <p>您已经一键领取过空投了!</p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="packing" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">通知</h4>
        </div>
        <div class="modal-body">
          <p>交易正在打包, 请稍等几秒钟。</p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="parepareWallet" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">通知</h4>
        </div>
        <div class="modal-body">
          <p>正在为您准备钱包，请稍等几秒钟。您的钱包地址如下: </p>
          <p ><a id="newWallet"></a></p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="oneClickAccount" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">通知</h4>
        </div>
        <div class="modal-body">
          <p ><a id="showOneClickSuccess"></a></p>
          <p>请妥善保管好您的私钥和记下私钥的解密的密码！在保存好您的私钥前请勿刷新页面，否则私钥将丢失！</p>
          <p><a id="newWalletAddress"></a></p>
          <textarea id="newWalletKey"></textarea>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal" onclick="copyPrivateKey()">拷贝私钥</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->


  <div id="oneClickFail" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">通知</h4>
        </div>
        <div class="modal-body">
          <p>一键领取失败！请按照步骤领取空投！</p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="packing_success" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">通知</h4>
        </div>
        <div class="modal-body">
          <p>交易打包成功!</p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  </body>
</html>
